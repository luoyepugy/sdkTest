/*! sdkProject 11-05-2015 */
function validate_tips(a){$("p.error_tip").remove(),$("body").append('<p class="error_tip">'+a+"</p>"),setTimeout(function(){$("p.error_tip").remove()},2e3)}function slide_horizontal(a){return 3>a&&a>-1?($(".header_tab li").removeClass("header_tab_cur"),$(".header_tab li").eq(a).addClass("header_tab_cur"),$(".tab_content").addClass("none"),$(".tab_content").eq(a).removeClass("none"),void 0):!1}function show_hide(){$(".division").first().rmClass("none"),$(".jq-list").first().addClass("mb3"),$(".jq-show-hide").on({click:function(a){$(".division").addClass("none"),$(".jq-list").rmClass("mb3"),$(this).find(".division").rmClass("none"),$(this).find(".jq-list").addClass("mb3")}})}function insertDatas(a){null==a.base_id?$(a.selector).append(a.insertElement):0==a.index?$(a.selector).find(a.childrenElement).first().before(a.insertElement):$(a.selector).find(a.childrenElement).eq(a.index-1).after(a.insertElement)}function load_tip_top(a){$("p.load_tip").remove(),$("article").find("section").first().before('<p class="load_tip">'+a+"</p>"),setTimeout(function(){$("p.load_tip").remove()},2e3)}function load_tip(a){$("p.load_tip").remove(),$("body").append('<p class="load_tip">'+a+"</p>"),setTimeout(function(){$("p.load_tip").remove()},2e3)}function loading(){$("body").append('<p class="loading"><img src="/sdkUI/dist/images/loading.gif" /></p>')}function uploadImg(a){var b=event.target.files[0];if(b){if(0!=b.type.indexOf("image")||!b.type||!/\.(?:jpg|png|gif)$/.test(b.name))return void validate_tips("请选择正确的图片格式");var c=new FileReader;c.readAsDataURL(b),c.onload=function(a){$.post("server.php",{img:a.target.result},function(a){""!=a.img?$("#user_portrait").attr("src",this.result):alert("upload fail")},"json")}}}function myfeedback(a){loading(),$.ajax({type:"GET",url:"/sdkUI/src/js/pages/myfeedback.json",dataType:"json",data:{type:a.type,base_id:a.base_id,number:a.number},success:function(b){if($(".loading").remove(),1==b.success){var c=b.data.total;if(0==c)load_tip("没有更多了");else if(c>0){var d=b.data.items;for(var e in d){"not_replied"==d[e].status?(d[e].status_color="font_sm gray_light inline_right tr green",d[e].status="等待回复"):"replied"==d[e].status?(d[e].status_color="font_sm gray_light inline_right tr",d[e].status="已回复"):(d[e].status_color="font_sm gray_light inline_right tr",d[e].status="已结束");var f='<a href="/sdkUI/dist/feedback/record.html" class="link_gray"><li><p class="myfeedback"><span class="inline_left">'+d[e].content+'</span><span class=" '+d[e].status_color+' ">'+d[e].status+'</span></p><p class="mt3 font_sm gray_light">最后更新时间：'+d[e].updated_at+'</p><input type="hidden" value=" '+d[e].id+' " /></li></a>';"get_older"==a.type?$(".jq-myfeedback").append(f):insertDatas({base_id:a.base_id,childrenElement:"li",selector:".jq-myfeedback",insertElement:f,index:e})}}}else validate_tips(b.message)},error:function(){$(".loading").remove(),validate_tips("加载数据错误")}})}function commonquestion(a){loading(),$.ajax({type:"GET",url:"/sdkUI/src/js/pages/commonquestion.json",dataType:"json",data:{page:a.page,number:a.number},success:function(a){if($(".loading").remove(),1==a.success){var b=a.data.items,c=a.data.total;if(0==c)load_tip("没有更多了");else if(c>0)for(var d in b){var e='<li class="jq-show-hide"><section class="message_question jq-list"><strong class="orange font_lg inline_left">Q:</strong><p class="inline_right">'+b[d].question+'</p></section><section class="message_question division none"><strong class="green font_lg inline_left">A:</strong><p class="gray_mid font_md inline_right">'+b[d].answer+"</p></section></li>;";$.delay(show_hide,200),$(".jq-commonquestion").append(e)}}else validate_tips(a.message)},error:function(){$(".loading").remove(),validate_tips("加载数据错误")}})}function getData(a){loading(),$.ajax({type:"GET",url:"/sdkUI/src/js/pages/record.json",dataType:"json",data:{type:a.type,number:a.number,base_id:a.base_id},success:function(b){if($(".loading").remove(),1==b.success){var c=b.data.items,d=b.data.total;if(0==d)load_tip_top("没有更多了");else if(d>0)for(var e in c){var f='<section class="message_record tr"><p class="p tc font_sm gray_light">'+c[e].time+'</p><p class="input inline_right tl">'+c[e].content+'</p><span class="inline_left ml2"><img src=" '+c[e].avatar_url+'" /></span><input type="hidden" value=" '+c[e].id+' " /></section>',g='<section class="message_record"><p class="p tc font_sm gray_light">'+c[e].time+'</p><span class="inline_left mr2"><img src=" '+c[e].avatar_url+'" /></span><p class="input green inline_right">'+c[e].content+'</p><input type="hidden" value=" '+c[e].id+' " /></section>';insertDatas("user"==c[e].user_type?{base_id:a.base_id,childrenElement:"section",selector:".jq-record",insertElement:f,index:e}:{base_id:a.base_id,childrenElement:"section",selector:".jq-record",insertElement:g,index:e})}}else $(".loading").remove(),validate_tips(b.message)},error:function(){validate_tips("加载数据错误")}})}function getDatas(a){loading(),$.ajax({type:"GET",url:"/sdkUI/src/js/pages/trade.json",dataType:"json",data:{type:a.type,status:a.status,number:a.number,base_id:a.base_id},success:function(b){if($(".loading").remove(),1==b.success){var c=b.data.items,d=b.data.total;if(0==d)load_tip("没有更多了");else if(d>0)for(var e in c){1==c[e].status?(c[e].status_color="green fr",c[e].status="成功"):(c[e].status_color="orange fr",c[e].status="未成功");var f='<li class="jq-show-hide"><p>'+c[e].stuff+'<span class="'+c[e].status_color+'">'+c[e].status+'</span></p><p class="font_sm gray_light jq-list">'+c[e].payment+'支付<span class="orange trade_price">'+c[e].money+'</span>元<span class="fr">'+c[e].time+'</span><input type="hidden" value=" '+c[e].id+' " /></p><div class="division none"><p class="gray_mid font_md">订单号：'+c[e].order_number+'</p><p class="gray_mid font_md">说明：'+c[e].content+'</p><input type="hidden" value=" '+c[e].id+' " /></div></li>';$.delay(show_hide,200),0==a.status?"get_older"==a.type?$(".jq-trade-all").append(f):insertDatas({base_id:a.base_id,childrenElement:"li",selector:".jq-trade-all",insertElement:f,index:e}):1==a.status?"get_older"==a.type?$(".jq-trade-success").append(f):insertDatas({base_id:a.base_id,childrenElement:"li",selector:".jq-trade-success",insertElement:f,index:e}):2==a.status&&("get_older"==a.type?$(".jq-trade-fail").append(f):insertDatas({base_id:a.base_id,childrenElement:"li",selector:".jq-trade-fail",insertElement:f,index:e}))}}else validate_tips(b.message)},error:function(){$(".loading").remove(),validate_tips("加载数据错误")}})}!function(a){a.app().ctrl({tab_menu:function(b){b.tab_toggle=function(){a(".header_tab").children().removeClass("header_tab_cur"),a(this).addClass("header_tab_cur"),a(".tab_content").addClass("none");var b=Number(a(this).attr("data-index"));a(".tab_content").eq(b).removeClass("none")}}})}(Qmik),function(a){a.app().ctrl({changePwdForm:function(b){b.submit=function(b){var c=a("#new_password").val(),d=a("#old_password").val(),e=a("#confirm_password").val();console.log(d),""==d?validate_tips("请输入旧密码"):""==c?validate_tips("请输入新密码"):c!==e?validate_tips("两次密码输入不一致"):a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",data:{old_password:d,new_password:c},success:function(a){0==a.success?validate_tips(a.message):window.location.href="/sdkUI/dist/index.html"},error:function(){validate_tips("加载数据错误")}})}}})}(Qmik),function(a){a.app().ctrl({radio:function(b){b.choice=function(b){a('input[name="sex"]').removeAttr("checked"),a(this).find('input[name="sex"]').attr("checked","checked"),a(".icon-radio-checked").addClass("gray_light").removeClass("green"),a(this).find(".icon-radio-checked").removeClass("gray_light").addClass("green")}},editUserForm:function(b){b.submit=function(b){var c=a("#user_nickname").val(),d=a(this).find('input[checked="checked"]').val(),e=a("#user_birthday").val(),f=a("#user_hometown").val();""==c?validate_tips("请输入昵称"):c.length>10?validate_tips("请输入10个字以内的昵称"):a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",data:{name:c,sex:d,birthday:e,hometown:f},success:function(a){0==a.success?validate_tips(a.message):window.location.href="/sdkUI/dist/index.html"},error:function(){validate_tips("加载数据错误")}})}}})}(Qmik),function(a){a.app().ctrl({identity:function(b){var c="phone";b.checked=function(){a(".jq-list").find("i").addClass("icon-radio-unchecked"),a(this).find("i").removeClass("icon-radio-unchecked"),a(".division").addClass("none"),a(".jq-list").rmClass("mb3"),a(this).next(".division").rmClass("none"),a(this).addClass("mb3"),a(".jq-next-btn").attr("data-url",a(this).attr("data-url")),c=a(this).attr("data-identity"),"email"==c?a(".jq-next-btn").parent().next().removeClass("none"):a(".jq-next-btn").parent().next().addClass("none")},b.get_code=function(){var b=a('input[name="phone"]').val();a.ajax({type:"GET",url:"/sdkUI/src/js/pages/identity.json",dataType:"json",data:{phone:b},success:function(a){return 0!=a.success?!1:void validate_tips(a.message)},error:function(){validate_tips("加载数据错误")}})},b.next_step=function(){var b=/^((145|147)|(15[^4])|(17[6-8])|((13|18)[0-9]))\d{8}$/,d=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,e=a('input[name="phone"]').val(),f=a('input[name="verification_code"]').val(),g=a('input[name="email"]').val(),h=a(this).find("a").attr("data-url");"phone"==c?""==e?validate_tips("请输入手机号码"):""==f?validate_tips("请输入验证码"):b.test(e)?a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",data:{phone:e,verification_code:f},success:function(a){0==a.success?validate_tips(a.message):window.location.href=h},error:function(){validate_tips("加载数据错误")}}):validate_tips("请输入正确的手机号码格式"):""==g?validate_tips("请输入邮箱地址"):d.test(g)?a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",data:{email:g},success:function(a){0==a.success?validate_tips(a.message):window.location.href=h},error:function(){validate_tips("加载数据错误")}}):validate_tips("请输入正确的邮箱地址格式")}}})}(Qmik),function(a){a.app().ctrl({"switch":function(b){var c,d=0;b.switch_toggle=function(b){d%2==0?(a(this).removeClass("switch_active").addClass("switch_close"),c="off",d+=1):(a(this).addClass("switch_active").removeClass("switch_close"),c="on",d-=1),a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",data:{status:c},success:function(a){0==a.success&&validate_tips(a.message)},error:function(){validate_tips("加载数据错误")}})}}})}(Qmik),function(a){a.app().ctrl({commonQuestion:function(a){commonquestion({page:1,number:5})},feedbackForm:function(b){a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",success:function(b){0==b.success?(validate_tips(b.message),a(".jq-submit-feedback").children().removeClass("none"),a(".jq-submit-feedback p").eq(0).addClass("none")):(a(".jq-submit-feedback").children().addClass("none"),a(".jq-submit-feedback p").eq(0).removeClass("none"))},error:function(){validate_tips("加载数据错误")}}),b.submit=function(){var b=/^((145|147)|(15[^4])|(17[6-8])|((13|18)[0-9]))\d{8}$/,c=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,d=a('textarea[name="content"]').val(),e=document.getElementById("feedback_type").options.selectedIndex,f=document.getElementById("feedback_type").options[e].value,g=document.getElementById("problem_type").options.selectedIndex,h=document.getElementById("problem_type").options[g].value,i=a('input[name="email"]').val(),j=a('input[name="phone"]').val();""==d?validate_tips("请输入意见描述"):""==f?validate_tips("请选择反馈类型"):""==h?validate_tips("请选择问题分类"):""==i?validate_tips("请输入邮箱地址"):""==j?validate_tips("请输入联系电话"):b.test(j)?c.test(i)?a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",data:{content:d,feedback_type:f,problem_type:h,email:i,phone:j},success:function(a){0==a.success?validate_tips(a.message):window.location.href="/sdkUI/dist/index.html"},error:function(){validate_tips("加载数据错误")}}):validate_tips("请输入正确的邮箱地址格式"):validate_tips("请输入正确的手机号码格式")}},myfeedback:function(a){myfeedback({type:"get_newer",number:5,base_id:null})},question:function(b){var c={};b.on({touchstart:function(a){var b=a.targetTouches[0];startPos={x:b.pageX,y:b.pageY,time:(new Date).getTime()}},touchmove:function(a){var b=a.targetTouches[0];c={x:b.pageX-startPos.x,y:b.pageY-startPos.y,time:(new Date).getTime()-startPos.time}},touchend:function(){var b=Number(a(".header_tab_cur").attr("data-index")),d=document.body.clientHeight||document.documentElement.clientHeight,e=window.screen.height,f=window.pageYOffset;if(Math.abs(c.x)>Math.abs(c.y)&&c.x<-50&&c.time>120)b+=1,slide_horizontal(b),c={x:0,y:0,time:0};else if(Math.abs(c.x)>Math.abs(c.y)&&c.x>50&&c.time>120)b-=1,slide_horizontal(b),c={x:0,y:0,time:0};else if(Math.abs(c.x)<Math.abs(c.y)&&c.y<-50&&c.time>120){if(!(f+e+10>=d))return;if(2==b){var g=a(".jq-myfeedback").find("li").last().find('input[type="hidden"]').val();myfeedback({type:"get_older",number:6,base_id:g})}else if(0==b){var h=2;commonquestion({page:h,number:5}),h+=1}c={x:0,y:0,time:0}}else if(Math.abs(c.x)<Math.abs(c.y)&&c.y>50&&c.time>120){if(!(10>f))return;if(2==b){var i=a(".jq-myfeedback").find("li").first().find('input[type="hidden"]').val();myfeedback({type:"get_newer",number:6,base_id:i})}else if(0==b){var h=1;commonquestion({page:h,number:5})}c={x:0,y:0,time:0}}}})}})}(Qmik),function(a){a.app().ctrl({chat_record:function(b){getData({type:"get_newer",number:5}),b.send_message=function(){var b=a(this).prev("input").val();return a(this).prev("input").val(""),""==b?!1:void a.ajax({type:"GET",url:"/sdkUI/src/js/pages/record.json",dataType:"json",data:{messages:b,number:5},success:function(c){if(a(this).prev("input").attr("value",""),1==c.success){b="";var d=c.data.items;for(var e in d){var f='<section class="message_record tr"><p class="p tc font_sm gray_light">'+d[e].time+'</p><p class="input inline_right tl">'+d[e].content+'</p><span class="inline_left ml2"><img src=" '+d[e].avatar_url+'" /></span><input type="hidden" value=" '+d[e].id+' " /></section>';a(".jq-record").append(f)}}else validate_tips(c.message)},error:function(){validate_tips("加载数据错误")}})};var c={};b.on({touchstart:function(a){var b=a.targetTouches[0];startPos={x:b.pageX,y:b.pageY,time:(new Date).getTime()}},touchmove:function(a){var b=a.targetTouches[0];c={x:b.pageX-startPos.x,y:b.pageY-startPos.y,time:(new Date).getTime()-startPos.time}},touchend:function(b){var d=window.pageYOffset,e=a(".jq-record section").first().find('input[type="hidden"]').val()||null;Math.abs(c.x)<Math.abs(c.y)&&c.y>50&&c.time>120&&10>d&&(getData({async:!0,type:"get_older",number:6,base_id:e}),c={x:0,y:0,time:0})}})}})}(Qmik),function(a){a.app().ctrl({resetPwdForm:function(b){b.submit=function(b){var c=a("#new_password").val(),d=a("#confirm_password").val();""==c?validate_tips("请输入新密码"):c!==d?validate_tips("两次密码输入不一致"):a.ajax({type:"GET",url:"/sdkUI/src/js/pages/change-password.json",dataType:"json",data:{new_password:c},success:function(a){0==a.success?validate_tips(a.message):window.location.href="/sdkUI/dist/index.html"},error:function(){validate_tips("加载数据错误")}})}}})}(Qmik),function(a){a.app().ctrl({trade_all:function(a){getDatas({type:"get_newer",status:0,number:6,base_id:null})},trade_success:function(a){getDatas({type:"get_newer",status:1,number:6,base_id:null})},trade_fail:function(a){getDatas({type:"get_newer",status:2,number:6,base_id:null})},slide:function(b){var c={};b.on({touchstart:function(a){var b=a.targetTouches[0];startPos={x:b.pageX,y:b.pageY,time:(new Date).getTime()}},touchmove:function(a){var b=a.targetTouches[0];c={x:b.pageX-startPos.x,y:b.pageY-startPos.y,time:(new Date).getTime()-startPos.time}},touchend:function(){var b=Number(a(".header_tab_cur").attr("data-index")),d=document.body.clientHeight||document.documentElement.clientHeight,e=window.screen.height,f=window.pageYOffset;if(Math.abs(c.x)>Math.abs(c.y)&&c.x<-50&&c.time>120)b+=1,slide_horizontal(b),c={x:0,y:0,time:0};else if(Math.abs(c.x)>Math.abs(c.y)&&c.x>50&&c.time>120)b-=1,slide_horizontal(b),c={x:0,y:0,time:0};else if(Math.abs(c.x)<Math.abs(c.y)&&c.y<-50&&c.time>120){if(!(f+e+10>=d))return;var g=a(".tab_content").eq(b).children("li").last().find('input[type="hidden"]').val();getDatas({async:!0,type:"get_older",status:b,number:6,base_id:g}),c={x:0,y:0,time:0}}else if(Math.abs(c.x)<Math.abs(c.y)&&c.y>50&&c.time>120){if(!(10>f))return;var h=a(".tab_content").eq(b).children("li").first().find('input[type="hidden"]').val();getDatas({async:!0,type:"get_newer",status:b,number:6,base_id:h}),c={x:0,y:0,time:0}}}})}})}(Qmik);