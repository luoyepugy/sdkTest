define(["./module"],function(e){e.directive("submitButton",["httpService","messageService","validateService","$state","userService",function(e,t,s,i,n){return{restrict:"AE",replace:!0,template:'<p class="tc mt10"><button class="button button-balanced">{{text}}</button></p>',scope:{},link:function(o,r,a){o.text=a.text;var l,u,c=a.state||"",d=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,f=/^((145|147)|(15[^4])|(17[6-8])|((13|18)[0-9]))\d{8}$/;r.bind("click",function(){if(l=s.isEmpty(a.form),1!==l)return t.show(l),!1;if(u=s.submitData(a.form),null!==u.email&&void 0!==u.email&&d.test(u.email)===!1)t.show("请输入正确的邮箱格式");else if(null!==u.phone&&void 0!==u.phone&&f.test(u.phone)===!1)t.show("请输入正确的手机号码格式");else if(null!==u.password&&void 0!==u.password&&u.password.length<4)t.show("请输入至少4位密码");else if(null!==u.confirmPwd&&void 0!==u.confirmPwd&&u.confirmPwd!==u.password)t.show("两次密码输入不一致");else{var r=e.getData(a.action,u);r.then(function(e){if(t.show(e.message),i.go(c),"true"===a.user)for(var s in o.$parent.user)n.user[s]=o.$parent.user[s];else"true"===a.login&&(n.user=e.data)})}})}}}])});